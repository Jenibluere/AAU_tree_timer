<!DOCTYPE HTML>
<head>
	<title>Jeni's tree timer</title>
	<!-- Bootstrap CSS -->
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
</head>
<body>
<div id="contentWrapper">
	<h1>Welcome to Jeni's tree timer!</h1>
	<div id="instructionsBox">
		<p>Simply choose your tree from the dropdown list and whether the tree is in an optimum environment, plant the tree and press go.</p>
		<p>The timer will give a warning, 15 minutes in advance, and a final alarm at the timer finish.</p>
	</div>
	<div id="settingsWrapper">
		<p>Choose tree</p>
		<div class="dropdown">
		    <select id="treeSelect">
				<option value="apple">apple</option>
				<option value="hornbeam">hornbeam</option>
				<option value="oak">oak</option>
				<option value="cork">cork</option>
				<option value="grapevine">grapevine</option>
				<option value="fig">fig</option>
				<option value="yucca">yucca</option>
				<option value="avocado">avocado</option>
				<option value="poplar">poplar</option>
				<option value="lemon">lemon</option>
				<option value="cedar">cedar</option>
				<option value="banana">banana</option>
				<option value="traveler">traveler's tree</option>
			</select>
		</div>
		
	</div>
	<div id="timerWrapper">
		<div class="counter">1</div>
		<button class="button">Start</button>
	</div>
	<div id="errorBox"></div>
</div>

<!-- Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
<!-- <script src="timerscript.js"></script> -->

<script>
	
	(function() {

		var root = document.documentElement;
	    var container = document.querySelector('.container');
	    var button = document.querySelector('.button');
	    var counter = document.querySelector('.counter');
	    var running = false;
	    var timer = null;
	    var seconds = 0;
	    var secondsInitial = 0;
	    var e = document.getElementbyID("treeSelect");
	    var interval = 1000; // ms

		var treeDict = {
			//type : [mature_time, climate]
			"apple": [14.3, "temperate"],
			"hornbeam": [8, "N/A"],
			"oak": [49, "temperate"],
			"cork": [5+(43/60),"temperate"],
			"grapevine": [5+(43/60),"temperate"],
			"fig": [5+(43/60),"tropical"],
			"yucca": [26,"arid"],
			"avocado": [5+(43/60),"tropical"],
			"poplar": [12,"N/A"],
			"lemon": [14.3,"arid"],
			"cedar": [26, "temperate"],
			"banana": [26,"tropical"],
			"traveler": [14.3,"tropical"],
		};

		button.addEventListener("click", function () {
			if (running){
				stop();
			} else {
				start();
			}
			running = !running;
		});

		function start() {
			// get value time from dropdown
			var time = treeDict[e.options[e.selectedIndex].value][0];
			seconds = time*60**2; // Convert time to secs
			var expected = Date.now() + interval

			counter.innerText = seconds;

			setTimeout(step, interval);
			function step() {
			    var dt = Date.now() - expected; // the drift (positive for overshooting)
			    if (dt > interval) {
			        // something really bad happened. Maybe the browser (tab) was inactive?
			        var errorSound = new Audio('erro.mp3');
					errorSound.play();
					document.querySelector('#errorBox').innerText = "Your browser may have skipped time, please double check this."
			    }

			    counter.innerText = seconds;
				if (!seconds) {
					stop();
					running = false;
				}

			    expected += interval;
			    setTimeout(step, Math.max(0, interval - dt)); // take into account drift
			}	
		}

		function stop(){
			clearInterval(timer);
		}
	})();

</script>

</body>
</HTML>